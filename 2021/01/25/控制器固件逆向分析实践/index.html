<!DOCTYPE html><html lang="en"><head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<link rel="preconnect" href="//www.googletagmanager.com">
	<link rel="preconnect" href="//zz.bdstatic.com">
	<link rel="preconnect" href="//sp0.baidu.com">
	<link rel="preconnect" href="//www.google-analytics.com">
	<link rel="preconnect" href="//cdn1.lncld.net">
	<link rel="preconnect" href="//unpkg.com">
	<link rel="preconnect" href="//app-router.leancloud.cn">
	<link rel="preconnect" href="//9qpuwspm.api.lncld.net">
	<link rel="preconnect" href="//gravatar.loli.net">

	<title>控制器固件逆向分析实践（以施耐德NOE 771为例） | Hexo</title>

	<meta name="HandheldFriendly" content="True">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
	<meta name="generator" content="hexo">
	<meta name="author" content="Fstark">
	<meta name="description" content="">

	
	<meta name="keywords" content="">
	

	
	<link rel="shortcut icon" href="https://i.loli.net/2017/11/26/5a19c0b50432e.png">
	<link rel="apple-touch-icon" href="https://i.loli.net/2017/11/26/5a19c0b50432e.png">
	

	
	<meta name="theme-color" content="#3c484e">
	<meta name="msapplication-TileColor" content="#3c484e">
	

	

	

	<meta property="og:site_name" content="Hexo">
	<meta property="og:type" content="article">
	<meta property="og:title" content="控制器固件逆向分析实践（以施耐德NOE 771为例） | Hexo">
	<meta property="og:description" content="">
	<meta property="og:url" content="http://example.com/2021/01/25/%E6%8E%A7%E5%88%B6%E5%99%A8%E5%9B%BA%E4%BB%B6%E9%80%86%E5%90%91%E5%88%86%E6%9E%90%E5%AE%9E%E8%B7%B5/">

	
	<meta property="article:published_time" content="2021-01-25T14:01:20+08:00"> 
	<meta property="article:author" content="Fstark">
	<meta property="article:published_first" content="Hexo, /2021/01/25/%E6%8E%A7%E5%88%B6%E5%99%A8%E5%9B%BA%E4%BB%B6%E9%80%86%E5%90%91%E5%88%86%E6%9E%90%E5%AE%9E%E8%B7%B5/">
	

	
	
	
<link rel="stylesheet" href="/css/allinonecss.min.css">


	
	
	
</head>

<body class="post-template">
	<div class="site-wrapper">
		




<header class="site-header post-site-header outer">
    <div class="inner">
        
<nav class="site-nav"> 
    <div class="site-nav-left">
        <ul class="nav">
            <li>
                
                <a href="/" title="Home">HOME</a>
                
            </li>
            
            
            <li>
                <a href="/about" title="ABOUT">ABOUT</a>
            </li>
            
            
        </ul> 
    </div>
    
    <div class="search-button-area">
        <a href="#search" class="search-button">Search ...</a>
    </div>
     
    <div class="site-nav-right">
        
        <a href="#search" class="search-button">Search ...</a>
         
        
<div class="social-links">
    
    
    
    
    
    <a class="social-link" title="telegram" href="https://t.me/Fstarkss" target="_blank" rel="noopener">
        <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M679.428571 746.857143l84-396q5.142857-25.142857-6-36t-29.428571-4L234.285714 501.142857q-16.571429 6.285714-22.571428 14.285714t-1.428572 15.142858 18.285715 11.142857l126.285714 39.428571 293.142857-184.571428q12-8 18.285714-3.428572 4 2.857143-2.285714 8.571429l-237.142857 214.285714-9.142857 130.285714q13.142857 0 25.714285-12.571428l61.714286-59.428572 128 94.285715q36.571429 20.571429 46.285714-21.714286z m344.571429-234.857143q0 104-40.571429 198.857143t-109.142857 163.428571-163.428571 109.142857-198.857143 40.571429-198.857143-40.571429-163.428571-109.142857-109.142857-163.428571T0 512t40.571429-198.857143 109.142857-163.428571T313.142857 40.571429 512 0t198.857143 40.571429 163.428571 109.142857 109.142857 163.428571 40.571429 198.857143z"></path></svg>
    </a>
    
    
    
</div>
    </div>
</nav>
    </div>
</header>


<div id="site-main" class="site-main outer" role="main">
    <div class="inner">
        <header class="post-full-header">
            <div class="post-full-meta">
                <time class="post-full-meta-date" datetime="2021-01-25T14:28:06.206Z">
                    2021-01-25
                </time>
                
                <span class="date-divider">/</span>
                
                <a href="/categories/%E5%B7%A5%E6%8E%A7/">工控</a>&nbsp;&nbsp;
                
                
            </div>
            <h1 class="post-full-title">控制器固件逆向分析实践（以施耐德NOE 771为例）</h1>
        </header>
        <div class="post-full no-image">
            
            <div class="post-full-content">
                <article id="photoswipe" class="markdown-body">
                    <h2 id="【实验要求】"><a href="#【实验要求】" class="headerlink" title="【实验要求】"></a>【实验要求】</h2><p>针对施耐德NOE 771固件进行逆向分析，并获取到隐藏在汇编代码中的后门账号。</p>
<a id="more"></a>

<h2 id="【实验目的】"><a href="#【实验目的】" class="headerlink" title="【实验目的】"></a>【实验目的】</h2><p>理解固件逆向对于安全工作的意义；熟悉主要的固件逆向工具和方法；掌握IDA Pro进行静态分析的使用方式；掌握Binwalk对文件和固件的一般分析方法；</p>
<h2 id="【实验原理】"><a href="#【实验原理】" class="headerlink" title="【实验原理】"></a>【实验原理】</h2><h3 id="1-固件"><a href="#1-固件" class="headerlink" title="1.固件"></a>1.固件</h3><p>在计算机领域中固件（firmware）是一种为设备提供控制、监控、数据操作等功能的微型系统。嵌入式设备就是一些典型的含有固件的设备，BIOS也是固件的一种，同样的我们经常使用的硬盘设备也有其自己的固件。</p>
<h3 id="2-VXworks"><a href="#2-VXworks" class="headerlink" title="2.VXworks"></a>2.VXworks</h3><p>本次实验的施耐德NOE771固件所使用的底层操作系统为Vxworks 5系列，CPU结构为PowerPC。<br>VxWorks操作系统是美国WindRiver公司于1983年设计开发的一种嵌入式实时操作系统（RTOS），它以其良好的可靠性和卓越的实时性被广泛地应用在通信、军事、航空及航天等高精尖技术领域中。甚至连1997年4月在火星表面登陆的火星探测器、2008年5月登陆的凤凰号，和2012年8月登陆的好奇号也都使用到了VxWorks系统。</p>
<h3 id="3-固件识别和解压"><a href="#3-固件识别和解压" class="headerlink" title="3.固件识别和解压"></a>3.固件识别和解压</h3><p>固件的识别和解压，可以借用一些成熟的工具软件，如：Binwalk、BAT（Binary AnalysisToolkit）等。Binwalk和BAT均为比较流行的固件映像提取和分析工具。Binwalk以MIT License发布，BAT以GPL License发布。它们支持的固件映像解压格式对比表如下：</p>
<p><img alt="img" class="post-img b-lazy" data-img="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f3lb0otwj30n409w4qp.jpg" data-index="0" data-src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f3lb0otwj30n409w4qp.jpg"><br>对于常见的嵌入式设备固件可以使用Binwalk或BAT来解压并提取固件文件。对于无法自动解压的固件，可以尝试以下方法分析：使用文件分析工具获得固件映像文件的基本数据类型。<br>使用字符串打印工具提取文件中所包含的明码字段，寻找是否有引导装载程序以及操作系统内核的信息。<br>使用十六进制转储工具（如hexdump）分析为了对齐固件文件空间分段而放入的连续填充字节，文件系统标识有可能紧跟其后。<br>文件系统有可能使用非标准的特征符，如果发现可疑特征符字段，可以替换为标准特征符，再尝试由固件解压工具进行识别。</p>
<h3 id="4-固件静态分析"><a href="#4-固件静态分析" class="headerlink" title="4.固件静态分析"></a>4.固件静态分析</h3><p>固件静态分析指的是在不对嵌入式系统进行实际运行的情况下，通过对固件文件进行逆向解析，分析固件中各代码的调用关系及代码内容从而发现嵌入式系统可能存在的漏洞及后门或针对已发现的漏洞进行定位的一种技术手段。固件静态分析过程中将会涉及到固件提取、加载地址分析等各种分析技术。<br>固件解压之后的分析主要集中在对常见漏洞入口进行针对性的静态分析，包括：密码、默认开启的服务、端口、配置文件等。分析方法如下：</p>
<p>1）尝试提取文件中包含的明码字段是否存在硬编码密码等。</p>
<p>2）发掘固件的关联性，包括分析固件作者、库使用、目录结构、配置文件关键字、定制默认密码等信息。</p>
<p>3）对二进制可执行文件进行反汇编分析，可以借用一些成熟的工具软件，如：IDA Pro、Capstone等。对特定的嵌入式系统（如VxWorks）的登录模块进行反汇编分析，获取其登录密码的哈希算法等信息。</p>
<p>4）如果发现包含密码哈希的文件，可考虑使用John the Ripper或Hash Suite等工具进行暴力破解。前者有版本支持GPU加速（支持CUDA和OpenCL）。使用暴力破解工具可以利用前述步骤中提取的关键字，显著加快运行效率。</p>
<h3 id="5-IDA-Pro"><a href="#5-IDA-Pro" class="headerlink" title="5.IDA Pro"></a>5.IDA Pro</h3><p>IDA Pro是应用最广泛的静态反汇编工具，它支持对大量的CPU架构进行逆向分析，包括X86、MIPS、PowerPC及Arm等。</p>
<h3 id="6-Capstone"><a href="#6-Capstone" class="headerlink" title="6.Capstone"></a>6.Capstone</h3><p>Capstone是一个反汇编框架，它支持多种平台，能够运行在Windows、Mac OS X、Linux、FreeBSD、OpenBSD和Solaris中。Capstone可反汇编ARM、ARM64(ARMv8)、MIPS、PPC和X86架构下的应用。</p>
<h2 id="【实验环境】"><a href="#【实验环境】" class="headerlink" title="【实验环境】"></a>【实验环境】</h2><p><img alt="image-20191029152459378" class="post-img b-lazy" data-img="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f3ndb967j30jy0e040v.jpg" data-index="1" data-src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f3ndb967j30jy0e040v.jpg"></p>
<p>主机操作系统：Windows、Linux、macOS选其一</p>
<p>主机虚拟机：VMware、VirtualBox、KVM选其一</p>
<p>Windows XP：IDA Pro</p>
<p>Kali Linux：Metasploit、Python、Capstone等</p>
<h2 id="【实验步骤】"><a href="#【实验步骤】" class="headerlink" title="【实验步骤】"></a>【实验步骤】</h2><h3 id="1-实验准备"><a href="#1-实验准备" class="headerlink" title="1.实验准备"></a>1.实验准备</h3><p>准备好部署有IDA Pro的Windows虚拟机，以及可以使用binwalk、python、十六进制编辑器的环境，例如Kali虚拟机，确保虚机可以方便的进行文件拷贝，也可以使用文件服务器的方式进行共享。准备Vxworks相关文献资料，必要的时候可以直接进行查阅。</p>
<h3 id="2-获取固件升级包"><a href="#2-获取固件升级包" class="headerlink" title="2.获取固件升级包"></a>2.获取固件升级包</h3><p>在通常情况下，我们通过官网获取到的固件升级包，是一个包含了嵌入式固件的一个升级包。我们需要从该升级包中将真正的固件提取出来进行分析。<br>从施耐德官方网站下载固件升级包，从该升级包中提取固件文件。NOE 771的固件文件名为NOE77101.bin。</p>
<h3 id="3-识别和解压升级包"><a href="#3-识别和解压升级包" class="headerlink" title="3.识别和解压升级包"></a>3.识别和解压升级包</h3><p>提取固件通常的方法是使用Binwalk等二进制分析工具对固件升级包进行自动化分析，待确认升级包类型后在进行解压或其他操作。<br>NOE771的固件文件名为NOE77101.bin，首先我们需要使用Binwalk来确认该文件的类型。通过使用Binwalk进行自动分析可以发现，该固件升级包包含了一个zlib压缩的文件。</p>
<p><img alt="截屏2019-10-28下午8.06.00" class="post-img b-lazy" data-img="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f3vpmszhj313u0l3nop.jpg" data-index="2" data-src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f3vpmszhj313u0l3nop.jpg"></p>
<p>Binwalk支持提取zlib压缩的文件，我们可以通过如下命令进行解压</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Binwalk-e NOE77101.bin</span><br></pre></td></tr></tbody></table></figure>
<p>解压后的文件385将存储在_NOE77101.bin.extracted目录中，并以文件在固件升级包中的起始位置来命名。</p>
<p>下图为解压固件升级包结果。</p>
<p><img alt="截屏2019-10-28下午8.06.53" class="post-img b-lazy" data-img="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f3xj7a19j313u0l3noz.jpg" data-index="3" data-src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f3xj7a19j313u0l3noz.jpg"></p>
<h3 id="4-固件提取"><a href="#4-固件提取" class="headerlink" title="4.固件提取"></a>4.固件提取</h3><p>通过继续使用Binwalk对解压后的385文件进行分析可见，Binwalk已成功的分析出了固件中的一些路径名等信息，由此可见该文件的确是NOE771所加载的固件文件。</p>
<p>下图查看固件主要文件路径和程序结构以及版本信息。</p>
<p><img alt="截屏2019-10-28下午8.08.18" class="post-img b-lazy" data-img="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f3yz2jcwj313u0l3k8y.jpg" data-index="4" data-src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f3yz2jcwj313u0l3k8y.jpg"></p>
<h3 id="5-分析固件内存加载地址"><a href="#5-分析固件内存加载地址" class="headerlink" title="5.分析固件内存加载地址"></a>5.分析固件内存加载地址</h3><p>由于嵌入式系统的固件需要加载到内存中的特定位置进行运行，这个特定的位置就叫做固件加载地址（base address）。<br>嵌入式系统的固件内的一些绝对地址调用（例如字符串）均是基于固件加载地址所计算出的内存地址，而不是固件文件中的偏移量地址。例如某函数调用了内存位置为0x30000的字符指针，且我们的固件加载地址为0x10000，那么该字符串在固件文件中的实际位置就是“内存位置”-“固件加载地址”，也就是0x20000。<br>因此为了使IDA能够正确的对代码进行解析，我们需要分析出固件的加载地址，否则所有涉及到绝对地址调用的代码解析都将是错误的。</p>
<p>某些固件会采用一些封装，比较典型的封装方法是使用ELF封装。通过封装后的ELF文件头部有特定的数据位记录了该固件的加载地址，因此针对该情况我们可以直接读取ELF文件头，从而直接获取到固件的加载地址。<br>ELF的全称是Executable and Linkable Format，常被称为ELF格式。通过使用greadelf之类的工具可以轻松的获取ELF文件的信息。<br>由于NOE771的固件并没有采用任何封装，因此针对NOE771的固件我们将通过分析固件头部的代码来大致猜测固件的加载地址。<br>使用IDA Pro分析嵌入式系统固件的话，首先我们需要确认目标的CPU类型从而选择正确的反汇编引擎。我们可以通过使用Binwalk–A命令来分析。<br><img alt="截屏2019-10-28下午8.52.39" class="post-img b-lazy" data-img="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f41ie2mjj313u0l37r9.jpg" data-index="5" data-src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f41ie2mjj313u0l37r9.jpg"><br>在得知了目标CPU架构是PowerPC big endian后我们就可以只用IDA加载并进行初步分析。</p>
<p><img alt="image-20191029154240162" class="post-img b-lazy" data-img="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f45s1a5kj31390nz4i1.jpg" data-index="6" data-src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f45s1a5kj31390nz4i1.jpg"></p>
<p><img alt="image-20191029154303971" class="post-img b-lazy" data-img="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f466injcj31390nzqmt.jpg" data-index="7" data-src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f466injcj31390nzqmt.jpg"></p>
<p>IDA Pro进行正确的固件加载默认加载后的IDA界面看起来像是这样的。仅仅分析出了极少数的函数</p>
<p><img alt="image-20191029154424149" class="post-img b-lazy" data-img="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f47kj0g6j31390nz7bl.jpg" data-index="8" data-src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f47kj0g6j31390nz7bl.jpg"></p>
<p>虽然现在我们可以成功反编译，但我们还需要确定固件的代码段基址才能重构符号表<br>确定基址的思路是寻找一条相对寻址方式的lis指令。</p>
<p><img alt="5b5021411a2fa" class="post-img b-lazy" data-img="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f4aykgsaj30mb0150mh.jpg" data-index="9" data-src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f4aykgsaj30mb0150mh.jpg"></p>
<p>在IDA中使用ALT+T直接搜lis指令，CTRL+T进行向下(上)搜索，发现在000009F8处的lis指令</p>
<p><img alt="截屏2019-10-28下午9.42.56" class="post-img b-lazy" data-img="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f4c3yajoj31d10lawol.jpg" data-index="10" data-src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f4c3yajoj31d10lawol.jpg"></p>
<p>观察地址后面的@ha确定基址为0x10000,这也是固件常用基址</p>
<p>对@h和@ha的问题，可以看下图<img alt="5b50214142c8e" class="post-img b-lazy" data-img="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f4dmpoz8j30rv0anaam.jpg" data-index="11" data-src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f4dmpoz8j30rv0anaam.jpg"></p>
<p>这是powerPC汇编的特性问题，可以参考以下这篇文章：</p>
<p><a target="_blank" rel="noopener" href="http://blog.chinaunix.net/uid-20663797-id-35772.html">http://blog.chinaunix.net/uid-20663797-id-35772.html</a></p>
<p>现在我们就需要验证0x10000是否是我们真正的加载地址了。我们需要重新使用IDAPro加载固件文件，并按照下图进行配置。</p>
<p><img alt=" " class="post-img b-lazy" data-img="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f4i4e78jj31d10lae7l.jpg" data-index="12" data-src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f4i4e78jj31d10lae7l.jpg"></p>
<p>配置正确的内存开始和加载地址完成后我们就可以看到IDA Pro能够正常的分析固件的函数调用关系了。</p>
<p><img alt="image-20191029155711712" class="post-img b-lazy" data-img="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f4kviinoj31390nzahs.jpg" data-index="13" data-src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f4kviinoj31390nzahs.jpg"></p>
<h3 id="6-利用符号表修复IDA中的函数名"><a href="#6-利用符号表修复IDA中的函数名" class="headerlink" title="6.利用符号表修复IDA中的函数名"></a>6.利用符号表修复IDA中的函数名</h3><p>如之前所看到的，IDA虽然成功分析出了函数的调用关系。但是尚无法自动识别出函数的名字，这对我们进行分析造成了很大的阻碍。因此我们需要查看固件是否包含了符号表，如固件包含了符号表那么我们就可以利用符号表中的内容来修复IDA中所显示的函数名。<br>符号表（Symbol table）是一种用于语言翻译器中的数据结构，在符号表中，程序源代码中的每个标识符都和它的声明或使用信息绑定在一起，比如其数据类型、作用域以及内存地址。在Vxworks中如果没有符号表我们将不能在shell中执行任何命令，因为Vxworks不知道命令名所对应代码的具体位置。<br>由于Vxworks系统的符号表包含了函数及函数名的对应关系，因此我们的第一步就是要找到符号表在固件中的位置。<br>之前使用Binwalk分析固件时，已经发现了固件中的符号表位置为0x301E74。</p>
<p>在获取了符号表在固件中的位置后，我们就可以使用16进制编辑器对固件进行查看从而确认Binwalk分析出的地址是否正确。<br>Vxworks 5系列的符号有他独特的格式，他以16个字节为一组数据，前4个字节是0x00，之后是函数名的内存地址，后4个字节是函数的内存地址，最后以4个特征字节数据结尾。<br>通过查看Binwalk分析出的地址位置可见，这个地址的确是符号表但是Binwalk的检测结果有一些偏移实际的符号表起始位置是0x301e60。</p>
<p><img alt="截屏2019-10-29上午10.07.44" class="post-img b-lazy" data-img="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f4ney6vkj31d10la4qp.jpg" data-index="14" data-src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f4ney6vkj31d10la4qp.jpg"></p>
<p>由于符号表有他自己的特征，因此能够通过遍历的方式快速的锁定符号表的起始及结束地址。我们所测试的固件的符号表起始地址为0x301e60+0x10000，结束地址为0x3293b0+0x10000。</p>
<p><img alt="截屏2019-10-29上午10.09.54" class="post-img b-lazy" data-img="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f4nnqbq2j31d10la1kx.jpg" data-index="15" data-src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f4nnqbq2j31d10la1kx.jpg"></p>
<p>在得到了符号表的位置后，我们就需要使用IDA的api来修复函数名，这里将使用如下的Python脚本。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> idaapi <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># 符号表间隔</span></span><br><span class="line">symbol_interval = <span class="number">16</span></span><br><span class="line">load_address = <span class="number">0x10000</span></span><br><span class="line">symbol_table_start = <span class="number">0x301e60</span> + load_address</span><br><span class="line">symbol_table_end = <span class="number">0x3293b0</span> + load_address</span><br><span class="line">ea = symbol_table_start</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> ea &lt; symbol_table_end:</span><br><span class="line">    <span class="comment"># 循环遍历修复函数名</span></span><br><span class="line">    offset = <span class="number">4</span></span><br><span class="line">    MakeStr(Dword(ea + offset), BADADDR)</span><br><span class="line">    sName = GetString(Dword(ea + offset), -<span class="number">1</span>, ASCSTR_C)</span><br><span class="line">    print(sName)</span><br><span class="line">    <span class="keyword">if</span> sName:</span><br><span class="line">        eaFunc = Dword(ea + offset + <span class="number">4</span>)</span><br><span class="line">        MakeName(eaFunc, sName)</span><br><span class="line">        MakeCode(eaFunc)</span><br><span class="line">        MakeFunction(eaFunc, BADADDR)</span><br><span class="line">    ea += symbol_interval</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>在IDA的脚本中运行</p>
<p><img alt="截屏2019-10-29上午10.23.47" class="post-img b-lazy" data-img="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f4wi7rsrj30m40frdm5.jpg" data-index="16" data-src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f4wi7rsrj30m40frdm5.jpg"></p>
<p>运行之后发现旁边函数列表大多函数都找到了符号表中对应的名称</p>
<p><img alt="image-20191029160942747" class="post-img b-lazy" data-img="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f4xwb6loj31390nzqd7.jpg" data-index="17" data-src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f4xwb6loj31390nzqd7.jpg"></p>
<h3 id="7-后门代码分析"><a href="#7-后门代码分析" class="headerlink" title="7.后门代码分析"></a>7.后门代码分析</h3><p>在固件预处理完成后，我们就可以通过查看固件的服务加载过程查看初始化时所添加的账号等信息。查看usrAppinit函数，可以发现大量的loginUserAddd调用。（多个后门函数）</p>
<p><img alt="截屏2019-10-29上午11.03.43" class="post-img b-lazy" data-img="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f504uq6hj31390nzgyc.jpg" data-index="18" data-src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f504uq6hj31390nzgyc.jpg"></p>
<p>而密码则是经过loginDefaultEncrypt函数哈希加密<br>结合vxworks5的源码来看</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/******************************************************************************</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* loginDefaultEncrypt - default password encryption routine</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* This routine provides default encryption for login passwords.  It employs</span></span><br><span class="line"><span class="comment">* a simple encryption algorithm.  It takes as arguments a string &lt;in&gt; and a</span></span><br><span class="line"><span class="comment">* pointer to a buffer &lt;out&gt;.  The encrypted string is then stored in the</span></span><br><span class="line"><span class="comment">* buffer.</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* The input strings must be at least 8 characters and no more than 40</span></span><br><span class="line"><span class="comment">* characters.</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* If a more sophisticated encryption algorithm is needed, this routine can</span></span><br><span class="line"><span class="comment">* be replaced, as long as the new encryption routine retains the same</span></span><br><span class="line"><span class="comment">* declarations as the default routine.  The routine vxencrypt</span></span><br><span class="line"><span class="comment">* in \f3host/&lt;hostOs&gt;/bin\fP</span></span><br><span class="line"><span class="comment">* should also be replaced by a host version of &lt;encryptionRoutine&gt;.  For more</span></span><br><span class="line"><span class="comment">* information, see the manual entry for loginEncryptInstall().</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* RETURNS: OK, or ERROR if the password is invalid.</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* SEE ALSO: loginEncryptInstall(), vxencrypt</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* INTERNAL</span></span><br><span class="line"><span class="comment">* The encryption is done by summing the password and multiplying it by</span></span><br><span class="line"><span class="comment">* a magic number.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">STATUS loginDefaultEncrypt</span><br><span class="line">    (</span><br><span class="line">    <span class="keyword">char</span> *in,                           <span class="comment">/* input string */</span></span><br><span class="line">    <span class="keyword">char</span> *out                           <span class="comment">/* encrypted string */</span></span><br><span class="line">    )</span><br><span class="line">    {</span><br><span class="line">    <span class="keyword">int</span>            ix;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span>  magic     = <span class="number">31695317</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span>  passwdInt = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (<span class="built_in">strlen</span> (in) &lt; <span class="number">8</span> || <span class="built_in">strlen</span> (in) &gt; <span class="number">40</span>)</span><br><span class="line">        {</span><br><span class="line">	errnoSet (S_loginLib_INVALID_PASSWORD);</span><br><span class="line">        <span class="keyword">return</span> (ERROR);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (ix = <span class="number">0</span>; ix &lt; <span class="built_in">strlen</span>(in); ix++)         <span class="comment">/* sum the string */</span></span><br><span class="line">        passwdInt += (in[ix]) * (ix+<span class="number">1</span>) ^ (ix+<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">sprintf</span> (out, <span class="string">"%u"</span>, (<span class="keyword">long</span>) (passwdInt * magic)); <span class="comment">/* convert interger</span></span><br><span class="line"><span class="comment">							to string */</span></span><br><span class="line">    <span class="comment">/* make encrypted passwd printable */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (ix = <span class="number">0</span>; ix &lt; <span class="built_in">strlen</span> (out); ix++)</span><br><span class="line">        {</span><br><span class="line">        <span class="keyword">if</span> (out[ix] &lt; <span class="string">'3'</span>)</span><br><span class="line">            out[ix] = out[ix] + <span class="string">'!'</span>;    <span class="comment">/* arbitrary */</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (out[ix] &lt; <span class="string">'7'</span>)</span><br><span class="line">            out[ix] = out[ix] + <span class="string">'/'</span>;    <span class="comment">/* arbitrary */</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (out[ix] &lt; <span class="string">'9'</span>)</span><br><span class="line">            out[ix] = out[ix] + <span class="string">'B'</span>;    <span class="comment">/* arbitrary */</span></span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (OK);</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2018/07/19/5b5021f38a71a.jpg"><img alt="mark" class="post-img b-lazy" data-img="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f58cr8q2j30od0jaaaq.jpg" data-index="19" data-src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f58cr8q2j30od0jaaaq.jpg"></a><br><a target="_blank" rel="noopener" href="https://i.loli.net/2018/07/19/5b5021f39f749.jpg"><img alt="mark" class="post-img b-lazy" data-img="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f58ej37bj30og0hsq43.jpg" data-index="20" data-src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f58ej37bj30og0hsq43.jpg"></a><br><a target="_blank" rel="noopener" href="https://i.loli.net/2018/07/19/5b5021f3b3958.jpg"><img alt="mark" class="post-img b-lazy" data-img="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f58gdnqwj30oo0ekwex.jpg" data-index="21" data-src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f58gdnqwj30oo0ekwex.jpg"></a></p>
<p>结合源码看汇编就非常清晰了</p>
<blockquote>
<p>加密过程：</p>
<p>1.在第一个for循环中密码字符串逐字节与位置下标相乘再按位进行异或操作，然后将每一个字符的运算结果累加起来算出passwdInt。<br>2.passwdInt值与magic相乘再转化为String类型。<br>3.字符串逐字符与’3’、’7’、’9’进行比较，加相应的值。</p>
<p>可以通过随机生成密码来构建一个序列化的输入密码和passwdInt的对应表，同时passwdInt与输出密码之间也可构建对应表，这样输入密码和输出密码讲通过长度有限的Int类型passwdInt打通，这样我们就能通过查表的方式由输出密码得到输入密码。相比于MD5、SHA1等加密算法，vxencrypt加密算法由于加密方式问题导致密文长度受限，以至于存在弱点。</p>
</blockquote>
<p>Rapid7 研究员HD Moore曾经发现VxWorks 5.x系统默认加密方式存在缺陷的研究文章</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://cvk.posthaven.com/how-to-crack-vxworks-password-hashes">http://cvk.posthaven.com/how-to-crack-vxworks-password-hashes</a></p>
</blockquote>
<p>解密程序</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/cvonkleist/vxworks_hash">https://github.com/cvonkleist/vxworks_hash</a></p>
</blockquote>
<p>这里贴上C的</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cvk/2010-08-09</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// password settings</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MIN_LENGTH 8</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_LENGTH 40</span></span><br><span class="line"><span class="keyword">char</span> *charset = <span class="string">" !\"#$%&amp;'()*+,-./0123456789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~"</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CHARSET_LENGTH 95</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// shortcut hash table</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_SUM 110000</span></span><br><span class="line"><span class="keyword">char</span> sums[MAX_SUM][MAX_LENGTH + <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// stage one of the hashing algorithm: the sum</span></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="title">sum</span><span class="params">(<span class="keyword">char</span> *plaintext)</span> </span>{</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">long</span> s = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">int</span> i;</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(plaintext); i++)</span><br><span class="line">    s += (plaintext[i]) * (i + <span class="number">1</span>) ^ (i + <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">return</span> s;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// builds a random password</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">random_password</span><span class="params">(<span class="keyword">char</span> *password)</span> </span>{</span><br><span class="line">  <span class="keyword">int</span> i;</span><br><span class="line">  <span class="keyword">int</span> length = rand() % (MAX_LENGTH - MIN_LENGTH) + MIN_LENGTH;</span><br><span class="line">  <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; length; i++)</span><br><span class="line">    password[i] = charset[rand() % CHARSET_LENGTH];</span><br><span class="line">  password[length] = <span class="string">'\0'</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// randomly creates checksums</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// when it discovers a shorter input plaintext for a checksum that has already</span></span><br><span class="line"><span class="comment">// been calculated, it replaces the existing plaintext with the new, shorter</span></span><br><span class="line"><span class="comment">// one</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">brute</span><span class="params">(<span class="keyword">int</span> runs)</span> </span>{</span><br><span class="line">  <span class="keyword">int</span> i;</span><br><span class="line">  <span class="keyword">char</span> password[MAX_LENGTH + <span class="number">1</span>];</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">long</span> s;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; runs; i++) {</span><br><span class="line">    random_password(password);</span><br><span class="line">    s = sum(password);</span><br><span class="line">    <span class="keyword">if</span>(s &gt; MAX_SUM) {</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"error! sum too big"</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(sums[s][<span class="number">0</span>] == <span class="string">'\0'</span> || <span class="built_in">strlen</span>(password) &lt; <span class="built_in">strlen</span>(sums[s])) {</span><br><span class="line">      <span class="built_in">strcpy</span>(sums[s], password);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// returns the number of checksums in the table</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">count</span><span class="params">()</span> </span>{</span><br><span class="line">  <span class="keyword">int</span> i;</span><br><span class="line">  <span class="keyword">int</span> c = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; MAX_SUM; i++)</span><br><span class="line">    <span class="keyword">if</span>(sums[i][<span class="number">0</span>] != <span class="string">'\0'</span>)</span><br><span class="line">      c++;</span><br><span class="line">  <span class="keyword">return</span> c;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// prints discovered checksums</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dump_table</span><span class="params">()</span> </span>{</span><br><span class="line">  <span class="keyword">int</span> i;</span><br><span class="line">  <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; MAX_SUM; i++)</span><br><span class="line">    <span class="keyword">if</span>(sums[i][<span class="number">0</span>] != <span class="string">'\0'</span>)</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"%d\t%s\n"</span>, i, sums[i]);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>{</span><br><span class="line">  brute(<span class="number">1000000000</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%d checksums\n"</span>, count());</span><br><span class="line">  dump_table();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="【预期结果】"><a href="#【预期结果】" class="headerlink" title="【预期结果】"></a>【预期结果】</h2><p>成功找到隐藏在固件封装程序中的若干个后门账号和密码</p>
<h2 id="【思考问题】"><a href="#【思考问题】" class="headerlink" title="【思考问题】"></a>【思考问题】</h2><p>（1）如果固件的内存加载地址并没有采用一般默认的0x10000，我们有哪些可能的办法去寻找其加载地址呢？</p>
<p>（2）除了本实验中提到的办法，还有什么其他思路可以找到固件的符号表地址？</p>
<p>（3）尝试下载工业控制安全教学实验箱中相关设备的固件进行后门分析，包括交换机、工业防火墙、施耐德PLC、西门子PLC和HMI。</p>
<h2 id="【参考资料】"><a href="#【参考资料】" class="headerlink" title="【参考资料】"></a>【参考资料】</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/yangmzh3/p/11231423.html">https://www.cnblogs.com/yangmzh3/p/11231423.html</a></p>
<p><a target="_blank" rel="noopener" href="https://paper.seebug.org/771/">https://paper.seebug.org/771/</a></p>
<p><a target="_blank" rel="noopener" href="https://paper.seebug.org/613/">https://paper.seebug.org/613/</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/hac425/p/9706815.html">https://www.cnblogs.com/hac425/p/9706815.html</a></p>
<p><a target="_blank" rel="noopener" href="http://www.360doc.com/content/15/1018/18/471722_506538709.shtml">http://www.360doc.com/content/15/1018/18/471722_506538709.shtml</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/12d8f509169c">https://www.jianshu.com/p/12d8f509169c</a></p>
<p><a target="_blank" rel="noopener" href="http://t.cn/RdORUWo">http://t.cn/RdORUWo</a></p>
<p><a target="_blank" rel="noopener" href="https://kabeor.cn/%E6%96%BD%E8%80%90%E5%BE%B7NOE77101%E4%BB%A5%E5%A4%AA%E7%BD%91%E6%A8%A1%E5%9D%97%E5%9B%BA%E4%BB%B6%E9%80%86%E5%90%91%E5%8F%8A%E5%90%8E%E9%97%A8%E6%8C%96%E6%8E%98/">https://kabeor.cn/施耐德NOE77101以太网模块固件逆向及后门挖掘/</a></p>

                </article>
                <ul class="tags-postTags">
                    
                    <li>
                        <a href="/tags/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" rel="tag"># 漏洞复现</a>
                    </li>
                    
                    <li>
                        <a href="/tags/%E5%9B%BA%E4%BB%B6%E9%80%86%E5%90%91/" rel="tag"># 固件逆向</a>
                    </li>
                    
                </ul>
            </div>
        </div>
    </div>

    
    <nav id="gobottom" class="pagination">
        
        <a class="prev-post" title="加壳脱壳初步学习总结与简单实战" href="/2021/01/25/%E5%8A%A0%E5%A3%B3%E8%84%B1%E5%A3%B3/">
            ← 加壳脱壳初步学习总结与简单实战
        </a>
        
        <span class="prev-next-post">·</span>
        
        <a class="next-post" title="（论文翻译）工业物联网中的安全和隐私挑战（Security and Privacy Challenges in Industrial Internet of Things）" href="/2021/01/25/%E8%AE%BA%E6%96%87%EF%BC%9A%E5%B7%A5%E4%B8%9A%E7%89%A9%E8%81%94%E7%BD%91%E4%B8%AD%E7%9A%84%E5%AE%89%E5%85%A8%E5%92%8C%E9%9A%90%E7%A7%81%E6%8C%91%E6%88%98%EF%BC%88Security%20and%20Privacy%20Challenges%20in%20Industrial%20Internet%20of%20Things%EF%BC%89/">
            （论文翻译）工业物联网中的安全和隐私挑战（Security and Privacy Challenges in Industrial Internet of Things） →
        </a>
        
    </nav>

    
    <div class="inner">
        <div id="comment"></div>
    </div>
    
</div>

<div class="toc-bar">
    <div class="toc-btn-bar">
        <a href="#site-main" class="toc-btn">
            <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M793.024 710.272a32 32 0 1 0 45.952-44.544l-310.304-320a32 32 0 0 0-46.4 0.48l-297.696 320a32 32 0 0 0 46.848 43.584l274.752-295.328 286.848 295.808z"></path></svg>
        </a>
        <div class="toc-btn toc-switch">
            <svg class="toc-open" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M779.776 480h-387.2a32 32 0 0 0 0 64h387.2a32 32 0 0 0 0-64M779.776 672h-387.2a32 32 0 0 0 0 64h387.2a32 32 0 0 0 0-64M256 288a32 32 0 1 0 0 64 32 32 0 0 0 0-64M392.576 352h387.2a32 32 0 0 0 0-64h-387.2a32 32 0 0 0 0 64M256 480a32 32 0 1 0 0 64 32 32 0 0 0 0-64M256 672a32 32 0 1 0 0 64 32 32 0 0 0 0-64"></path></svg>
            <svg class="toc-close hide" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M512 960c-247.039484 0-448-200.960516-448-448S264.960516 64 512 64 960 264.960516 960 512 759.039484 960 512 960zM512 128.287273c-211.584464 0-383.712727 172.128262-383.712727 383.712727 0 211.551781 172.128262 383.712727 383.712727 383.712727 211.551781 0 383.712727-172.159226 383.712727-383.712727C895.712727 300.415536 723.551781 128.287273 512 128.287273z"></path><path d="M557.05545 513.376159l138.367639-136.864185c12.576374-12.416396 12.672705-32.671738 0.25631-45.248112s-32.704421-12.672705-45.248112-0.25631l-138.560301 137.024163-136.447897-136.864185c-12.512727-12.512727-32.735385-12.576374-45.248112-0.063647-12.512727 12.480043-12.54369 32.735385-0.063647 45.248112l136.255235 136.671523-137.376804 135.904314c-12.576374 12.447359-12.672705 32.671738-0.25631 45.248112 6.271845 6.335493 14.496116 9.504099 22.751351 9.504099 8.12794 0 16.25588-3.103239 22.496761-9.247789l137.567746-136.064292 138.687596 139.136568c6.240882 6.271845 14.432469 9.407768 22.65674 9.407768 8.191587 0 16.352211-3.135923 22.591372-9.34412 12.512727-12.480043 12.54369-32.704421 0.063647-45.248112L557.05545 513.376159z"></path></svg>
        </div>
        <a href="#gobottom" class="toc-btn">
            <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M231.424 346.208a32 32 0 0 0-46.848 43.584l297.696 320a32 32 0 0 0 46.4 0.48l310.304-320a32 32 0 1 0-45.952-44.544l-286.848 295.808-274.752-295.36z"></path></svg>
        </a>
    </div>
    <div class="toc-main">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%80%90%E5%AE%9E%E9%AA%8C%E8%A6%81%E6%B1%82%E3%80%91"><span class="toc-text">【实验要求】</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%80%90%E5%AE%9E%E9%AA%8C%E7%9B%AE%E7%9A%84%E3%80%91"><span class="toc-text">【实验目的】</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%80%90%E5%AE%9E%E9%AA%8C%E5%8E%9F%E7%90%86%E3%80%91"><span class="toc-text">【实验原理】</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%9B%BA%E4%BB%B6"><span class="toc-text">1.固件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-VXworks"><span class="toc-text">2.VXworks</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%9B%BA%E4%BB%B6%E8%AF%86%E5%88%AB%E5%92%8C%E8%A7%A3%E5%8E%8B"><span class="toc-text">3.固件识别和解压</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%9B%BA%E4%BB%B6%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90"><span class="toc-text">4.固件静态分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-IDA-Pro"><span class="toc-text">5.IDA Pro</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-Capstone"><span class="toc-text">6.Capstone</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%80%90%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83%E3%80%91"><span class="toc-text">【实验环境】</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%80%90%E5%AE%9E%E9%AA%8C%E6%AD%A5%E9%AA%A4%E3%80%91"><span class="toc-text">【实验步骤】</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%AE%9E%E9%AA%8C%E5%87%86%E5%A4%87"><span class="toc-text">1.实验准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E8%8E%B7%E5%8F%96%E5%9B%BA%E4%BB%B6%E5%8D%87%E7%BA%A7%E5%8C%85"><span class="toc-text">2.获取固件升级包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%AF%86%E5%88%AB%E5%92%8C%E8%A7%A3%E5%8E%8B%E5%8D%87%E7%BA%A7%E5%8C%85"><span class="toc-text">3.识别和解压升级包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%9B%BA%E4%BB%B6%E6%8F%90%E5%8F%96"><span class="toc-text">4.固件提取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%88%86%E6%9E%90%E5%9B%BA%E4%BB%B6%E5%86%85%E5%AD%98%E5%8A%A0%E8%BD%BD%E5%9C%B0%E5%9D%80"><span class="toc-text">5.分析固件内存加载地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E5%88%A9%E7%94%A8%E7%AC%A6%E5%8F%B7%E8%A1%A8%E4%BF%AE%E5%A4%8DIDA%E4%B8%AD%E7%9A%84%E5%87%BD%E6%95%B0%E5%90%8D"><span class="toc-text">6.利用符号表修复IDA中的函数名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E5%90%8E%E9%97%A8%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-text">7.后门代码分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%80%90%E9%A2%84%E6%9C%9F%E7%BB%93%E6%9E%9C%E3%80%91"><span class="toc-text">【预期结果】</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%80%90%E6%80%9D%E8%80%83%E9%97%AE%E9%A2%98%E3%80%91"><span class="toc-text">【思考问题】</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%80%90%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99%E3%80%91"><span class="toc-text">【参考资料】</span></a></li></ol>
    </div>
</div>



<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>




	</div>
	


	




<div id="search" class="search-overlay">
    <div class="search-form">
        
        <div class="search-overlay-logo">
        	<img src="https://i.loli.net/2017/11/26/5a19c0b50432e.png" alt="Hexo">
        </div>
        
        <input id="local-search-input" class="search-input" type="text" name="search" placeholder="Search ...">
        <a class="search-overlay-close" href="#"></a>
    </div>
    <div id="local-search-result"></div>
</div>

<footer class="site-footer outer">
	<div class="site-footer-content inner">
		<div class="copyright">
			<a href="/" title="Hexo">Hexo © 2021</a>
			
				
			        <span hidden="true" id="/2021/01/25/%E6%8E%A7%E5%88%B6%E5%99%A8%E5%9B%BA%E4%BB%B6%E9%80%86%E5%90%91%E5%88%86%E6%9E%90%E5%AE%9E%E8%B7%B5/" class="leancloud-visitors" data-flag-title="控制器固件逆向分析实践（以施耐德NOE 771为例）">
			            <span>阅读量 </span>
			            <span class="leancloud-visitors-count">0</span>
			        </span>
	    		
    		
		</div>
		<nav class="site-footer-nav">
			
			<a href="https://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a>
			<a href="https://github.com/xzhih/hexo-theme-casper" title="Casper" target="_blank" rel="noopener">Casper</a>
		</nav>
	</div>
</footer>
	


<script>
    if(window.navigator && navigator.serviceWorker) {
        navigator.serviceWorker.getRegistrations().then(function(registrations) {
            for(let registration of registrations) {
                registration.unregister()
            }
        })
    }
</script>


<script id="scriptLoad" src="/js/allinone.min.js" async=""></script>


<script>
    document.getElementById('scriptLoad').addEventListener('load', function () {
        
        
            var bLazy = new Blazy();
        

        
        

        
        
        
            searchFunc("/");
        
        
    })
</script>




<link rel="stylesheet" href="/photoswipe/photoswipe.css">


<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">


<script src="/photoswipe/photoswipe.min.js"></script>


<script src="/photoswipe/photoswipe-ui-default.min.js"></script>





<script id="valineScript" src="//unpkg.com/valine/dist/Valine.min.js" async=""></script>
<script>
    document.getElementById('valineScript').addEventListener("load", function() {
        new Valine({
            el: '#comment' ,
            verify: false,
            notify: false,
            appId: '',
            appKey: '',
            placeholder: 'Just go go',
            pageSize: 10,
            avatar: 'mm',
            visitor: true
        })
    });
</script>







</body></html>